service: auxeira-metrics-collection
frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1
  stage: prod
  memorySize: 512
  timeout: 30
  environment:
    JWT_SECRET: ${env:JWT_SECRET, 'your-super-secret-jwt-key-change-in-production'}
    AWS_REGION: us-east-1
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
      Resource:
        - "arn:aws:dynamodb:us-east-1:*:table/auxeira-metrics-history"
        - "arn:aws:dynamodb:us-east-1:*:table/auxeira-metrics-history/index/*"
        - "arn:aws:dynamodb:us-east-1:*:table/auxeira-startup-profiles-prod"
        - "arn:aws:dynamodb:us-east-1:*:table/auxeira-startup-profiles-prod/index/*"
        - "arn:aws:dynamodb:us-east-1:*:table/auxeira-startup-activities-prod"
        - "arn:aws:dynamodb:us-east-1:*:table/auxeira-startup-activities-prod/index/*"

functions:
  metrics:
    handler: lambda-metrics-collection.handler
    url:
      cors:
        allowedOrigins:
          - '*'
        allowedHeaders:
          - '*'
        allowedMethods:
          - '*'
        maxAge: 86400

package:
  patterns:
    - lambda-metrics-collection.js
    - node_modules/**
    - '!node_modules/aws-sdk/**'
    - '!**/*.zip'
    - '!**/*.backup'
