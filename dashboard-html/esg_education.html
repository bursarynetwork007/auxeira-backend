<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESG Education Impact Dashboard - AI-Powered</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { margin: 0; background: #030712; color: white; font-family: system-ui; }
        .tab-button { cursor: pointer; padding: 1rem 2rem; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab-button.active { border-bottom-color: #3b82f6; color: #3b82f6; font-weight: bold; }
        .tab-button:hover { color: #60a5fa; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .report-card { transition: all 0.3s; cursor: pointer; }
        .report-card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3); border-color: #3b82f6; }
        .premium-badge { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
        .loading { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-6 shadow-lg">
            <div class="max-w-7xl mx-auto">
                <h1 class="text-4xl font-bold">ESG Education Dashboard</h1>
                <p class="text-blue-100 mt-2">AI-Powered Impact Intelligence | NanoGPT-5 + ScraperAPI</p>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-gray-900 border-b border-gray-800 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto flex gap-2">
                <div class="tab-button active" onclick="switchTab('overview')">
                    üìä Overview
                </div>
                <div class="tab-button" onclick="switchTab('reports')">
                    üìÑ AI Reports (15)
                </div>
                <div class="tab-button" onclick="switchTab('profile')">
                    üë§ Profile
                </div>
            </div>
        </div>

        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active">
            <div class="max-w-7xl mx-auto p-6">
                <!-- Impact Stats -->
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="bg-gray-900 rounded-lg p-6 text-center border border-gray-800">
                        <div class="text-4xl font-bold text-blue-400" data-bind="students_reached">--</div>
                        <div class="text-sm text-gray-400 mt-2">Students Reached</div>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-6 text-center border border-gray-800">
                        <div class="text-4xl font-bold text-green-400" data-bind="teachers_trained">--</div>
                        <div class="text-sm text-gray-400 mt-2">Teachers Trained</div>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-6 text-center border border-gray-800">
                        <div class="text-4xl font-bold text-purple-400" data-bind="schools_supported">--</div>
                        <div class="text-sm text-gray-400 mt-2">Schools Supported</div>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-6 text-center border border-gray-800">
                        <div class="text-4xl font-bold text-yellow-400" data-bind="sse_score">--</div>
                        <div class="text-sm text-gray-400 mt-2">Impact Score</div>
                    </div>
                </div>

                <!-- Time Toggle -->
                <div class="text-center mb-8">
                    <button id="toggle365" class="bg-blue-600 text-white px-6 py-3 rounded-lg mr-2 font-medium hover:bg-blue-700" onclick="loadData(365)">365 Days</button>
                    <button id="toggle5yr" class="bg-gray-800 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-700" onclick="loadData(1825)">5-Year History</button>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content">
            <div class="max-w-7xl mx-auto p-6">
                <div class="mb-8">
                    <h2 class="text-4xl font-bold mb-3">AI-Generated ESG Reports</h2>
                    <p class="text-gray-400 text-lg">Personalized insights powered by NanoGPT-5 + ScraperAPI ‚Ä¢ 15 Report Types</p>
                </div>

                <!-- Free Reports Section -->
                <div class="mb-8">
                    <h3 class="text-2xl font-bold mb-4 text-green-400">üéÅ Free Reports</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        
                        <!-- FREE: Impact Story -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border-2 border-green-600" onclick="generateReport('impact_story')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-5xl">‚ù§Ô∏è</div>
                                <span class="bg-green-600 text-white text-sm px-4 py-2 rounded-full font-bold">FREE</span>
                            </div>
                            <h3 class="text-2xl font-bold mb-3">Impact Story Report</h3>
                            <p class="text-gray-400 mb-4">Immersive 800-word narrative blending your goals with real-world transformation stories and ROI projections</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-green-900 text-green-300 px-3 py-1 rounded-full">Narrative</span>
                                <span class="text-xs bg-blue-900 text-blue-300 px-3 py-1 rounded-full">SDG Aligned</span>
                            </div>
                        </div>

                        <!-- FREE: Comparative Benchmark -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border-2 border-green-600" onclick="generateReport('comparative_benchmark')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-5xl">üìä</div>
                                <span class="bg-green-600 text-white text-sm px-4 py-2 rounded-full font-bold">FREE</span>
                            </div>
                            <h3 class="text-2xl font-bold mb-3">Comparative Benchmark</h3>
                            <p class="text-gray-400 mb-4">Compare your impact metrics to peers with efficiency ratios, policy alignment scores, and recommendations</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-purple-900 text-purple-300 px-3 py-1 rounded-full">Peer Analysis</span>
                                <span class="text-xs bg-blue-900 text-blue-300 px-3 py-1 rounded-full">Benchmarking</span>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Premium Reports Section -->
                <div>
                    <h3 class="text-2xl font-bold mb-4 text-yellow-400">‚≠ê Premium Reports</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        
                        <!-- 1. Scalability & Impact Expansion ($399) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('scalability_expansion')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üìà</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$399</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Scalability & Impact Expansion</h3>
                            <p class="text-gray-400 text-sm mb-4">Forecast scalability with growth matrix, cost projections, and 3-year impact scenarios</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-blue-900 text-blue-300 px-2 py-1 rounded">GRI</span>
                                <span class="text-xs bg-purple-900 text-purple-300 px-2 py-1 rounded">IRIS+</span>
                            </div>
                        </div>

                        <!-- 2. Stakeholder Engagement ($349) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('stakeholder_engagement')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">ü§ù</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$349</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Stakeholder Engagement</h3>
                            <p class="text-gray-400 text-sm mb-4">Evaluate community and government buy-in with stakeholder maps and engagement scores</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-green-900 text-green-300 px-2 py-1 rounded">IRIS+</span>
                                <span class="text-xs bg-blue-900 text-blue-300 px-2 py-1 rounded">SDG</span>
                            </div>
                        </div>

                        <!-- 3. Risk-Adjusted ROI ($499) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('risk_adjusted_roi')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">‚öñÔ∏è</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$499</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Risk-Adjusted ROI</h3>
                            <p class="text-gray-400 text-sm mb-4">Compute risk-adjusted returns with TCFD/SASB compliance and mitigation strategies</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-red-900 text-red-300 px-2 py-1 rounded">TCFD</span>
                                <span class="text-xs bg-orange-900 text-orange-300 px-2 py-1 rounded">SASB</span>
                            </div>
                        </div>

                        <!-- 4. Cross-Sector Collaboration ($449) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('cross_sector_collaboration')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üîó</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$449</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Cross-Sector Collaboration</h3>
                            <p class="text-gray-400 text-sm mb-4">Identify partnership opportunities with synergy scores and collaboration plans</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-purple-900 text-purple-300 px-2 py-1 rounded">SDG 17</span>
                            </div>
                        </div>

                        <!-- 5. Policy Alignment ($299) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('policy_alignment')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üìú</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$299</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Policy Alignment</h3>
                            <p class="text-gray-400 text-sm mb-4">Map investments to compliant policies with risk heatmaps and forecasts</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-blue-900 text-blue-300 px-2 py-1 rounded">UNESCO</span>
                            </div>
                        </div>

                        <!-- 6. ROI & Metrics Dashboard ($399) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('roi_metrics_dashboard')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üí∞</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$399</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">ROI & Metrics Dashboard</h3>
                            <p class="text-gray-400 text-sm mb-4">Data-rich report with IRR/MOIC analysis and global fund benchmarks</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-green-900 text-green-300 px-2 py-1 rounded">Quantitative</span>
                            </div>
                        </div>

                        <!-- 7. Cross-Impact Opportunity ($449) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('cross_impact_opportunity')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üåê</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$449</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Cross-Impact Opportunity</h3>
                            <p class="text-gray-400 text-sm mb-4">Uncover SDG synergies (education + climate/gender) with opportunity matrices</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-purple-900 text-purple-300 px-2 py-1 rounded">Multi-SDG</span>
                            </div>
                        </div>

                        <!-- 8. Materiality Assessment ($499) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('materiality_assessment')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üéØ</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$499</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Materiality Assessment</h3>
                            <p class="text-gray-400 text-sm mb-4">Identify financially material ESG issues with SASB/GRI alignment</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-red-900 text-red-300 px-2 py-1 rounded">SASB</span>
                                <span class="text-xs bg-orange-900 text-orange-300 px-2 py-1 rounded">GRI</span>
                            </div>
                        </div>

                        <!-- 9. Carbon & Decarbonization ($449) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('carbon_decarbonization')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üå±</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$449</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Carbon & Decarbonization</h3>
                            <p class="text-gray-400 text-sm mb-4">Track Scope 1-3 emissions with net-zero alignment and green premium forecasts</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-green-900 text-green-300 px-2 py-1 rounded">TCFD</span>
                                <span class="text-xs bg-blue-900 text-blue-300 px-2 py-1 rounded">CDP</span>
                            </div>
                        </div>

                        <!-- 10. Fund Benchmarking ($399) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('fund_benchmarking')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üìâ</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$399</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Fund Benchmarking & Screening</h3>
                            <p class="text-gray-400 text-sm mb-4">Screen investments vs 50,000+ funds with ESG scores and performance analytics</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-purple-900 text-purple-300 px-2 py-1 rounded">Morningstar</span>
                            </div>
                        </div>

                        <!-- 11. Regulatory Compliance ($499) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('regulatory_compliance')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">‚öñÔ∏è</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$499</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Regulatory Compliance</h3>
                            <p class="text-gray-400 text-sm mb-4">Ensure SFDR/CSRD compliance with gap analyses and disclosure templates</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-red-900 text-red-300 px-2 py-1 rounded">SFDR</span>
                                <span class="text-xs bg-orange-900 text-orange-300 px-2 py-1 rounded">IFRS</span>
                            </div>
                        </div>

                        <!-- 12. Policy Risk Watch ($299) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('policy_risk_watch')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üö®</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$299</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Policy Influence & Risk Watch</h3>
                            <p class="text-gray-400 text-sm mb-4">Track policy shifts with risk heatmaps and advocacy opportunities</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-red-900 text-red-300 px-2 py-1 rounded">Risk Analysis</span>
                            </div>
                        </div>

                        <!-- 13. ESG Scorecard ($349) -->
                        <div class="report-card bg-gray-900 rounded-xl p-6 border border-gray-800" onclick="generateReport('esg_scorecard')">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">üìä</div>
                                <span class="premium-badge text-white text-xs px-3 py-1 rounded-full font-bold">$349</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">ESG Scorecard</h3>
                            <p class="text-gray-400 text-sm mb-4">Dashboard-ready scorecard with E-S-G metrics and radar charts</p>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs bg-green-900 text-green-300 px-2 py-1 rounded">E-S-G</span>
                                <span class="text-xs bg-blue-900 text-blue-300 px-2 py-1 rounded">Benchmarked</span>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Report Generation Status -->
                <div id="report-status" class="mt-8 text-center text-gray-400" style="display: none;">
                    <div class="inline-block bg-gray-900 p-8 rounded-xl border border-gray-800">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-blue-500 mx-auto mb-4"></div>
                        <p id="status-message" class="text-xl">Generating your personalized report...</p>
                        <p class="text-sm text-gray-500 mt-2">This may take 10-30 seconds</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile-tab" class="tab-content">
            <div class="max-w-4xl mx-auto p-6">
                <h2 class="text-3xl font-bold mb-6">Your ESG Profile</h2>
                <p class="text-gray-400 mb-8">Complete your profile to generate personalized AI reports</p>
                
                <div class="bg-gray-900 rounded-xl p-8 border border-gray-800">
                    <form id="profile-form" class="space-y-6">
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Organization Name *</label>
                                <input type="text" name="organizationName" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3" placeholder="FutureLearn Impact Fund">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Website URL *</label>
                                <input type="url" name="websiteUrl" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3" placeholder="https://yourorg.com">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Sector Type *</label>
                                <select name="sectorType" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3">
                                    <option value="">Select...</option>
                                    <option>NGO</option>
                                    <option>Foundation</option>
                                    <option>Impact Fund</option>
                                    <option>Policy Unit</option>
                                    <option>CSR Division</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Country/Region *</label>
                                <input type="text" name="country" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3" placeholder="Kenya">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Education Focus Areas * (comma-separated)</label>
                            <input type="text" name="focusAreas" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3" placeholder="Teacher training, digital literacy, girls education">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">SDG Alignment (comma-separated numbers)</label>
                                <input type="text" name="sdgAlignment" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3" placeholder="4, 5, 10">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Annual Education Spend (USD)</label>
                                <input type="number" name="annualSpend" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3" placeholder="4500000">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Goal Statement *</label>
                            <textarea name="goalStatement" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 h-24" placeholder="Maximize measurable literacy outcomes for girls under 12"></textarea>
                        </div>
                        
                        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-lg font-bold text-lg hover:from-blue-700 hover:to-purple-700 transition">
                            üíæ Save Profile & Generate Reports
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'overview';

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
            currentTab = tabName;
        }

        async function loadData(days) {
            try {
                const response = await fetch(`./sim-data.json?days=${days}`);
                const data = await response.json();
                
                document.querySelectorAll('[data-bind]').forEach(el => {
                    const key = el.getAttribute('data-bind');
                    const value = data[0][key];
                    el.textContent = parseInt(value).toLocaleString();
                });
                
                document.getElementById('toggle365').className = 
                    days === 365 ? 'bg-blue-600 text-white px-6 py-3 rounded-lg mr-2 font-medium hover:bg-blue-700' 
                                 : 'bg-gray-800 text-white px-6 py-3 rounded-lg mr-2 font-medium hover:bg-gray-700';
                document.getElementById('toggle5yr').className = 
                    days === 1825 ? 'bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700' 
                                  : 'bg-gray-800 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-700';
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        async function generateReport(reportType) {
            const statusEl = document.getElementById('report-status');
            const messageEl = document.getElementById('status-message');
            
            const profileData = localStorage.getItem('esgProfile');
            if (!profileData) {
                alert('‚ö†Ô∏è Please complete your profile first!');
                switchTab('profile');
                return;
            }
            
            const profile = JSON.parse(profileData);
            statusEl.style.display = 'block';
            messageEl.textContent = 'Scraping your website data...';
            
            try {
                const response = await fetch('https://6qfa3ssb10.execute-api.us-east-1.amazonaws.com/prod/api/reports/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({profile: profile, reportType: reportType})
                });
                
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                messageEl.textContent = 'AI generating your report with NanoGPT-5...';
                const reportData = await response.json();
                
                console.log('=== REPORT DATA ===', reportData);
                
                messageEl.textContent = 'Creating your PDF...';
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let y = 20;
                
                // Title
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                const titleLines = doc.splitTextToSize(reportData.title || 'ESG Impact Report', 170);
                doc.text(titleLines, 20, y);
                y += titleLines.length * 8 + 5;
                
                // Organization
                doc.setFontSize(12);
                doc.text(profile.organizationName, 20, y);
                y += 6;
                doc.setFontSize(9);
                doc.setFont(undefined, 'normal');
                doc.text(`${profile.country} | ${new Date().toLocaleDateString()}`, 20, y);
                y += 12;
                
                // Executive Summary
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Executive Summary', 20, y);
                y += 7;
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                const summaryLines = doc.splitTextToSize(reportData.executive_summary || 'No summary available', 170);
                doc.text(summaryLines, 20, y);
                y += summaryLines.length * 5 + 8;
                
                // Key Metrics
                if (reportData.key_metrics && reportData.key_metrics.length > 0) {
                    if (y > 250) { doc.addPage(); y = 20; }
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('Key Metrics', 20, y);
                    y += 7;
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    
                    reportData.key_metrics.forEach(m => {
                        if (y > 270) { doc.addPage(); y = 20; }
                        doc.setFont(undefined, 'bold');
                        doc.text(`${m.metric}:`, 25, y);
                        doc.setFont(undefined, 'normal');
                        doc.text(m.value, 90, y);
                        y += 5;
                        if (m.source) {
                            doc.setFontSize(8);
                            doc.setTextColor(100);
                            doc.text(`Source: ${m.source}`, 27, y);
                            doc.setTextColor(0);
                            doc.setFontSize(10);
                            y += 5;
                        }
                    });
                    y += 5;
                }
                
                // Full Narrative
                if (reportData.full_narrative) {
                    if (y > 240) { doc.addPage(); y = 20; }
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('Impact Story', 20, y);
                    y += 7;
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    const narrativeLines = doc.splitTextToSize(reportData.full_narrative, 170);
                    narrativeLines.forEach(line => {
                        if (y > 280) { doc.addPage(); y = 20; }
                        doc.text(line, 20, y);
                        y += 5;
                    });
                    y += 5;
                }
                
                // Success Stories
                if (reportData.success_stories && reportData.success_stories.length > 0) {
                    doc.addPage();
                    y = 20;
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('Success Stories', 20, y);
                    y += 7;
                    
                    reportData.success_stories.forEach((story, i) => {
                        if (y > 250) { doc.addPage(); y = 20; }
                        doc.setFontSize(11);
                        doc.setFont(undefined, 'bold');
                        doc.text(`${i+1}. ${story.title}`, 20, y);
                        y += 6;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        const storyLines = doc.splitTextToSize(story.narrative, 170);
                        doc.text(storyLines, 20, y);
                        y += storyLines.length * 5 + 8;
                    });
                }
                
                // ROI & Actions
                if (reportData.roi_projection || reportData.recommended_actions) {
                    if (y > 200) { doc.addPage(); y = 20; }
                    
                    if (reportData.roi_projection) {
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.text('ROI Projection', 20, y);
                        y += 7;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        const roiLines = doc.splitTextToSize(reportData.roi_projection, 170);
                        doc.text(roiLines, 20, y);
                        y += roiLines.length * 5 + 10;
                    }
                    
                    if (reportData.recommended_actions && reportData.recommended_actions.length > 0) {
                        if (y > 250) { doc.addPage(); y = 20; }
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.text('Recommended Actions', 20, y);
                        y += 7;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        reportData.recommended_actions.forEach((action, i) => {
                            if (y > 280) { doc.addPage(); y = 20; }
                            const actionLines = doc.splitTextToSize(`${i+1}. ${action}`, 165);
                            doc.text(actionLines, 25, y);
                            y += actionLines.length * 5 + 3;
                        });
                    }
                }
                
                // Footer
                const pages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pages; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(128);
                    doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 285);
                    doc.text(`Page ${i} of ${pages}`, 105, 285, {align: 'center'});
                    doc.text('Powered by NanoGPT-5', 190, 285, {align: 'right'});
                }
                
                const filename = `${reportType}_${profile.organizationName.replace(/\s+/g,'_')}_${Date.now()}.pdf`;
                doc.save(filename);
                
                statusEl.style.display = 'none';
                alert(`‚úÖ AI Report Generated!\n\nFile: ${filename}\n\nTokens: ${reportData.tokensUsed || 'N/A'}`);
                
            } catch (error) {
                console.error('Error:', error);
                statusEl.style.display = 'none';
                alert(`‚ùå Error: ${error.message}`);
            }
        }




        document.getElementById('profile-form')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const profile = {
                organizationName: formData.get('organizationName'),
                websiteUrl: formData.get('websiteUrl'),
                sectorType: formData.get('sectorType'),
                country: formData.get('country'),
                focusAreas: formData.get('focusAreas').split(',').map(s => s.trim()),
sdgAlignment: formData.get('sdgAlignment').split(',').map(n => parseInt(n.trim())),
                annualSpend: formData.get('annualSpend'),
                goalStatement: formData.get('goalStatement'),
            };
            
            localStorage.setItem('esgProfile', JSON.stringify(profile));
            alert('‚úÖ Profile saved! You can now generate personalized AI reports.\n\nClick the "AI Reports" tab to get started.');
            switchTab('reports');
        });

        document.addEventListener('DOMContentLoaded', () => {
            loadData(365);
            
            const saved = localStorage.getItem('esgProfile');
            if (saved) {
                const profile = JSON.parse(saved);
                Object.keys(profile).forEach(key => {
                    const input = document.querySelector(`[name="${key}"]`);
                    if (input) {
                        if (Array.isArray(profile[key])) {
                            input.value = profile[key].join(', ');
                        } else {
                            input.value = profile[key];
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
